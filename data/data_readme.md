# DATA

> 数据层

数据层用于项目中所有基础数据的存储，包括：
- 人设
- 记忆
- 历史对话
## 数据结构
### 对话部分

- 对话内容

  对话内容是用户和 ai 进行交流的内容，对话内容将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「单日数据处理类」进行下一步处理

- 对话情绪

  对话情绪是用户和 ai 进行交流的情绪，对话情绪将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「短期记忆处理类」进行下一步处理

- 对话时间

  对话时间是用户和 ai 进行交流的时间，对话时间将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「短期记忆处理类」进行下一步处理

- 对话情绪值

  对话情绪值是用户和 ai 进行交流的情绪值，对话情绪值将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「短期记忆处理类」进行下一步处理

- 对话情绪值变化

  对话情绪值变化是用户和 ai 进行交流的情绪值变化，对话情绪值变化将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「短期记忆处理类」进行下一步处理

- 对话情绪值变化时间

  对话情绪值变化时间是用户和 ai 进行交流的情绪值变化时间，对话情绪值变化时间将会被存储在「短期记忆」中，当对话内容大于一个「单日记忆量」时，将会将对话内容交给「短期记忆处理类」进行下一步处理



### 记忆部分

- 短期记忆 

  短期记忆尽量复合人类记忆曲线， ai 将会百分百记得 20 分钟以内所有交谈内容，20分钟后将数据交给 「短期记忆处理类」进行下一步处理

- 中期记忆

  对于一天内的交流内容，（当交流内容大于一个「单日记忆量」时，将采取比重遗忘），此时将数据交给「单日数据处理类」进行下一步处理

- 长期记忆

  对于被筛选的内容将会被放入长期记忆，当一份长期记忆长期没有被检索到时，该记忆将会被删除

- 刻苦铭心的记忆

  对于某些触发关键词的记忆内容，将会给予少量拓展关键词，当用户/模型交谈内容触发关键词时，将会把相关记忆内容递给 ai 并进行新的内容生成，并且该记忆永远不会被遗忘


- 未处理的记忆

  对于未复习的记忆，将选取最接近人设性格相似内容的10% - 13% 进行永久保留，如果没有合适的将采取随机遗忘并使其遗忘至10%-13%，使其更符合人类记忆能力。

- 记忆回溯

  用户可选择是否开启，当用户开启回溯时，ai将会随机将当前输入内容放入历史对话数据库并进行检索，当提及关键词时，将会提取出该次对话内容并且将对该数据传入上下文 「开启该功能将会降低性能」

### 人设部分

#### 人设文件目录

```
avatars/
├── avatar_name/        # 角色配置文件
	├── angry/
	├── happy/
	├── neutral/
	├── sad/
	├── avatar.md
```



### 历史对话保留

**对于历史对话保留应当遵循以下原则:**

- 历史对话必须要有当前时间，ai 情绪值 ，当前对话内容，概括（用一个词对对话内容进行概括） 
- 历史对话必须是一对一关系，即一轮用户对话对应一轮回复